#!/bin/sh

NSENTER=$(dirname "$0")/nsenter

if [ -z "$1" ]; then
    echo "usage: docker-enter <container id/name> <command to run default:bash>"
else
    PID=$(docker inspect --format {{.State.Pid}} "$1")
    if [ -z "$PID" ]; then
        exit 1
    fi
    shift

    OPTS="--target $PID --mount --uts --ipc --net --pid -- env --ignore-environment"

    if [ -z "$1" ]; then
        if "$NSENTER" $OPTS sh -c "type bash" > /dev/null; then
            "$NSENTER" $OPTS bash -c "exec -cl bash"
        else
            "$NSENTER" $OPTS HOME=/root sh
        fi
    else
       "$NSENTER" $OPTS "$@"
    fi
fi
